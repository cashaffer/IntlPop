<!DOCTYPE html>
<!-- HTML page for a single simulation. The idea is that the user can
     pop up as many separate simulation windows as desired (triggered
     from IntlPop.html).
-->

<html>
<head>
  <meta charset="utf-8">
  <title>IntlPop Simulation Window</title>
<style>
/* Note: This will move to Simulation.css once things settle down and
   I'm not constantly having to reload the page for little changes! */
/* CSS file for styling a Simulation window */

* {
  margin: 0;
  padding: 0;
  font-size: 12px;
}

button {
  padding-left: 4px;
  padding-right: 4px;
  padding-top: 1px;
  padding-bottom: 1px;
}

#container {
  position: relative;
  top: 0;
  left: 0;
  width: 1060px;
  height: 352px;
  background-color: #efe;
}

#pyramidPanel { 
  position: absolute;
  width: 355px;
  height: 300px;
  top: 0;
  left: 0;
}

#popChartPanel { 
  position: absolute;
  width: 450px;
  height: 300px;
  top: 0;
  left: 350px;
}

#simPanel { 
  position: relative;
  width: 255px;
  height: 300px;
  top: 0;
  left: 800px;
}

/* This is where we send text messages to explain what is going on */
.output {
  position: absolute;
  height: 50px;
  width: 1048px;
  top: 291px;
  border: 1px solid black;
  padding: 5px;
}

#b1 {
  position: absolute;
  left: 0;
}

#b2 {
  position: absolute;
  right: 0;
}

#fertilityButton, #lifeExpButton, #netMigButton {
  position: relative;
  background-color: red;
  top: -100px;
  left: 55px;
}

#simBackButton, #simOptionsButton, #simForwardButton {
  position: relative;
  background-color: red;
  top: -75px;
  left: 48px;
}
</style>

</head>

<body>
<div id="container">
  <div id="main">
    <div id="pyramidPanel">
      <button id="b1">B1</button>
      <button id="b2">B2</button>
      <div id="birthChart"></div>
      <div id="deathChart"></div>
    </div>
    <div id="popChartPanel">
      <button id="fertilityButton">Fertility</button>
      <button id="lifeExpButton">Life Expectancy</button>
      <button id="netMigButton">Net Migration</button>
    </div>
    <div id="simPanel">
      <button id="simBackButton" disabled="disabled">&lt; Sim</button>
      <button id="simOptionsButton">Options</button>
      <button id="simForwardButton" disabled="disabled">Sim &gt;</button>
    </div>
  </div>
  <p class="output"></p>
</div>

<script src="lib/raphael.js"></script>
<script src="lib/jquery.min.js"></script>
<script>
/* Note: This will move to Simulation.js once things settle down and
   I'm not constantly having to reload the page for little changes! */
"use strict";
(function ($) {
  var tell = function (msg) { $('p.output').text(msg); };
  var inputFileLines; /* This will hold the country data */
  var country;

  // Set up the interface
  var rSim = new Raphael("simPanel", 255, 300);
  rSim.rect(5, 20, 245, 200);
  rSim.path("M20 50 L230 50");
  var initPopField = rSim.text(125, 35, "Initial Population:");
  var currYearField = rSim.text(125, 65, "");
  var currPopField = rSim.text(125, 80, "");

  var rChart = new Raphael("popChartPanel", 500, 300);
  var countryField = rChart.text(100, 100, "");
  var currYear = 2010;
  var currPop = 0;

  // Based on the URL of the current page, build the URL for a data file
  function buildURL(filename) {
    var pathArray = window.location.pathname.split( '/' );
    var theURL = window.location.protocol + "//" + window.location.host;
    for ( var i = 0; i < pathArray.length - 1; i++ ) {
      theURL += pathArray[i];
      theURL += "/";
    }
    theURL += filename;
console.log("Data URL is: " + theURL);
    return theURL;
  }

  console.log("This page's URL is: " + window.location.protocol + "//" +
              window.location.host + "/" + window.location.pathname);

  tell("Click on the 'Options' button to choose from among the available simulation features.");

  // Handler for Fertility button
  function fertility() {
    tell("Clicked on Fertility button.");
  }

  // Handler for options button
  function options() {
    tell("Clicked on simOptions button.");
    var dataURL = buildURL("US.js");
    $.getScript(dataURL, function () {
      country = setCountry(); // This loads the country
      console.log("Back now: " + country.name);
      countryField.attr('text', country.name);
      currPop = country.initPop;
      initPopField.attr('text', 'Initial Population: ' + currPop);
      currYearField.attr('text', 'Year: ' + country.startYear);
      currPopField.attr('text', 'Population: ' + country.initPop);
      $('#simForwardButton').removeAttr('disabled');
    });
  }

  // Handler for simForward button
  function simForward() {
    tell("Clicked on simForward button.");
    currPop = currPop * country.growthRate;
    currYear = currYear + 1;
    currYearField.attr('text', 'Year: ' + currYear);
    currPopField.attr('text', 'Population: ' + currPop);
    $('#simBackButton').removeAttr('disabled');
  }

  // Handler for simForward button
  function simBack() {
    tell("Clicked on simBack button.");
    currPop = currPop / country.growthRate;
    currYear = currYear - 1;
    currYearField.attr('text', 'Year: ' + currYear);
    currPopField.attr('text', 'Population: ' + currPop);
    if (currYear === country.startYear) {
      console.log("Disable Back button");
      $('#simBackButton').attr('disabled', 'disabled');
    }
  }

  // Button callbacks
  $('#fertilityButton').click(fertility);
  $('#simForwardButton').click(simForward);
  $('#simBackButton').click(simBack);
  $('#simOptionsButton').click(options);
}(jQuery));
</script>

</body>
</html>
